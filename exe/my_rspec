#!/usr/bin/env ruby

$LOAD_PATH << './spec'
$LOAD_PATH << './lib'

require "my_rspec"
require "pathname"
require 'pry'

specs = []
results = []
ARGV.each do |arg|
  spec_source = File.read(Pathname.new(arg).relative_path_from("./"))
  parser = MyRspec::SpecParser.new(spec_source)
  spec = MyRspec.instance_eval(spec_source)
  parser.search_node
  spec.annotate_sexp(parser.parsed_list)
  specs << spec
end
start_time = Time.now
specs.each do |spec|
  results << spec.run
end
end_time = Time.now

results.each do |result|
  if result.has_error?
    puts "\n\nFailures:\n"
  end
  puts "\n\nFinished in #{(end_time - start_time).to_f} seconds"
  result.print_result
end

